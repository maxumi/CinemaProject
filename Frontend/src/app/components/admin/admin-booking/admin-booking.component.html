<div class="container mx-auto mt-8">
  <div class="bg-gradient-to-r from-red-900 to-red-700 p-6 rounded-lg shadow-lg">
    <h3 class="text-xl font-semibold text-yellow-300 mb-4">Bookings</h3>
    <!-- Booking List -->
    <ul class="space-y-2 overflow-auto max-h-48 pr-2 max-w-sm">
      <li
        *ngFor="let booking of bookings"
        class="p-2 rounded-lg shadow text-sm cursor-pointer"
        [ngClass]="{
          'bg-yellow-300 text-red-900': selectedBookingId === booking.id,
          'bg-red-800 text-yellow-300': selectedBookingId !== booking.id
        }"
        (click)="selectBooking(booking.id)"
      >
        Booking #{{ booking.id }} (User ID: {{ booking.userId }})
      </li>
    </ul>

    <!-- Action Buttons -->
    <div class="mt-6 flex space-x-4">
      <button
        (click)="newBooking()"
        class="bg-yellow-400 text-red-900 px-6 py-2 rounded-lg hover:bg-yellow-500 hover:text-red-900 shadow transition-all"
      >
        New Booking
      </button>
      <button
        *ngIf="selectedBookingId"
        (click)="deleteBooking()"
        class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 shadow transition-all"
      >
        Delete Selected Booking
      </button>
    </div>

    <div class="mt-6">
      <h3 class="text-xl font-semibold text-yellow-300 mb-4">
        {{ selectedBookingId ? 'Edit Booking' : 'Create Booking' }}
      </h3>

      <!-- Booking Form -->
      <form [formGroup]="bookingForm" (ngSubmit)="createBooking()">

        <!-- User Search -->
        <div class="mb-4 relative">
          <label class="block text-yellow-300 font-medium mb-2">Search User:</label>
          <input
            type="text"
            #searchByFullName
            placeholder="Search by name"
            (input)="onUserSearch(searchByFullName.value)"
            class="border border-yellow-300 p-3 rounded-lg w-full focus:ring focus:ring-red-400 focus:outline-none text-black"
          />
          <ul
            *ngIf="users.length > 0"
            class="absolute bg-white shadow-lg border border-yellow-300 rounded-lg mt-1 max-h-40 overflow-auto w-full z-10"
          >
            <li
              *ngFor="let user of users"
              (click)="selectUser(user)"
              class="cursor-pointer px-3 py-2 hover:bg-yellow-300"
            >
              {{ user.fullName }}
            </li>
          </ul>
        </div>

        <!-- User ID -->
        <div class="mb-4">
          <label class="block text-yellow-300 font-medium mb-2">User ID:</label>
          <input
            formControlName="userId"
            type="number"
            readonly
            class="border border-yellow-300 p-3 rounded-lg w-full bg-gray-200 text-black"
          />
        </div>

        <!-- Number of Tickets -->
        <div class="mb-4">
          <label class="block text-yellow-300 font-medium mb-2">Number of Tickets:</label>
          <input
            formControlName="numberOfTickets"
            type="number"
            class="border border-yellow-300 p-3 rounded-lg w-full focus:ring focus:ring-red-400 focus:outline-none text-black"
          />
        </div>

        <!-- Movie Session Selection -->
        <div class="mb-4">
          <label class="block text-yellow-300 font-medium mb-2">Movie Session:</label>
          <select
            #movieSessionId
            formControlName="movieSessionId"
            class="border border-yellow-300 p-3 rounded-lg w-full focus:ring focus:ring-red-400 focus:outline-none text-black"
            (change)="onSessionChange(movieSessionId.value)"
          >
            <option value="" disabled>Select a session</option>
            <option *ngFor="let session of movieSessions" [value]="session.id">
              Movie ID: {{ session.movieId }} —
              Start: {{ session.startTime | date }} —
              Price: {{ session.price | currency }}
            </option>
          </select>
        </div>

        <!-- Seat Selection -->
        <div class="mb-4">
          <label class="block text-yellow-300 font-medium mb-2">Seats:</label>
          <div class="grid grid-cols-4 gap-2">
            <div
              *ngFor="let seat of seats"
              class="p-2 bg-yellow-300 text-red-900 rounded-lg cursor-pointer"
              (click)="toggleSeatSelection(seat.id)"
              [class.bg-yellow-500]="selectedSeatIds.includes(seat.id)"
            >
              {{ seat.seatNumber }}
            </div>
          </div>
        </div>

        <!-- Payment Details (Nested FormGroup) -->
        <div formGroupName="paymentDetail">
          <div class="mb-4">
            <label class="block text-yellow-300 font-medium mb-2">Payment Amount:</label>
            <input
              formControlName="amount"
              type="number"
              class="border border-yellow-300 p-3 rounded-lg w-full focus:ring focus:ring-red-400 focus:outline-none text-black"
            />
          </div>

          <div class="mb-4">
            <label class="block text-yellow-300 font-medium mb-2">Payment Method:</label>
            <select
              formControlName="method"
              class="border border-yellow-300 p-3 rounded-lg w-full focus:ring focus:ring-red-400 focus:outline-none text-black"
            >
              <option value="" disabled>Select a method</option>
              <option [value]="'Online'">Online</option>
              <option [value]="'OnPremise'">On Premise</option>
            </select>
          </div>

          <div class="mb-4">
            <label class="block text-yellow-300 font-medium mb-2">Payment Date:</label>
            <input
              formControlName="date"
              type="date"
              class="border border-yellow-300 p-3 rounded-lg w-full focus:ring focus:ring-red-400 focus:outline-none text-black"
            />
          </div>
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="bg-yellow-400 text-red-900 px-6 py-2 rounded-lg hover:bg-yellow-500 hover:text-red-900 shadow transition-all"
        >
          {{ selectedBookingId ? 'Save Changes' : 'Add Booking' }}
        </button>
      </form>
    </div>
  </div>
</div>
